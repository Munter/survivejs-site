<html lang="en"><head><title>SurviveJS - Building Kanban</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
Now that we have a nice Kanban application up and running, we can worry about showing it to the public. The goal of this chapter is to set up a nice production grade build. There are various techniques we can apply to bring the bundle size down. We can also leverage browser caching.

"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="./atom.xml"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/boots.jpg);"></div><h1 class="post__heading">Building Kanban</h1><div class="header-extra"><a href="https://www.flickr.com/photos/7870246@N03/481256246">Acid Pix (CC BY)</a></div><div class="toc-nav__wrapper"><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack_react/introduction">Introduction</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack_react/webpack">Setting Up Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/webpack_compared">Webpack Compared</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/developing_with_webpack">Developing with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/webpack_and_react">Webpack and React</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack_react/react">Developing a Kanban Application</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/implementing_notes">Implementing a Basic Note Application</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/react_and_flux">React and Flux</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/from_notes_to_kanban">From Notes to Kanban</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/implementing_dnd">Implementing Drag and Drop</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Building Kanban</span></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack_react/advanced">Advanced Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/testing_react">Testing React*</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/typing_with_react">Typing with React*</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/linting_in_webpack">Linting in Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/authoring_libraries">Authoring Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/styling_react">Styling React</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack_react/appendices">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/structuring_react_projects">Structuring React Projects</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/language_features">Language Features</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/understanding_decorators">Understanding Decorators</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack_react/troubleshooting">Troubleshooting</a></li></ul><div class="resources__wrapper"><h4 class="resources--header">Resources</h4><ul class="resources-nav"><li><a href="https://alexkuz.github.io/webpack-chart/" class="resource-nav__link" target="_blank">Webpack Chart</a></li><li><a href="https://chrisbateman.github.io/webpack-visualizer/" class="resource-nav__link" target="_blank">Webpack Visualizer</a></li><li><a href="https://github.com/robertknight/webpack-bundle-size-analyzer" class="resource-nav__link" target="_blank">Webpack Bundle Size Analyzer</a></li></ul></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/react-rocks-interview">React.rocks - React Components and Demos - Interview with Jeff Winkler</a></blockquote><div class="post__meta"><a class="post__end_source" href="https://github.com/survivejs/webpack_react/tree/master/project_source/08_building_kanban/kanban_app" target="_blank">Finished source code</a><a class="post__demo" href="/demos/08_building_kanban" target="_blank">Demo</a></div><div class="chapter-content"><p>Now that we have a nice Kanban application up and running, we can worry about showing it to the public. The goal of this chapter is to set up a nice production grade build. There are various techniques we can apply to bring the bundle size down. We can also leverage browser caching.</p>
<h2 class="header"><a class="header-anchor" href="#optimizing-build-size" id="optimizing-build-size"></a><span class="text">Optimizing Build Size</span><a class="header-anchor-select" href="#optimizing-build-size">#</a></h2>
<p>If you run <code>npm run build</code>, you can see we have a problem:</p>
<pre><code class="lang-bash"><span class="token operator" >></span> webpack

Hash: 807faffbf966eb7f08fc
Version: webpack 1.12.13
Time: 3967ms
    Asset     Size  Chunks             Chunk Names
bundle.js  1.12 MB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
    + 337 hidden modules
</code></pre>
<p>1.12 MB is a lot! There are a couple of basic things we can do to slim down our build. We can apply some minification to it. We can also tell React to optimize itself. Doing both will result in significant size savings. Provided we apply gzip compression on the content when serving it, further gains may be made.</p>
<h3 class="header"><a class="header-anchor" href="#minification" id="minification"></a><span class="text">Minification</span><a class="header-anchor-select" href="#minification">#</a></h3>
<p>Minification will convert our code into a smaller format without losing any meaning. Usually this means some amount of rewriting code through predefined transformations. Sometimes, this can break code as it can rewrite pieces of code you inadvertently depend upon. This is the reason why we gave explicit ids to our stores for instance.</p>
<p>The easiest way to enable minification is to call <code>webpack -p</code> (<code>-p</code> as in <code>production</code>). Alternatively, we an use a plugin directly as this provides us more control. By default Uglify will output a lot of warnings and they don&#39;t provide value in this case, we&#39;ll be disabling them. Add the following section to your Webpack configuration:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
<div class="leanpub-delete">
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>common<span class="token punctuation" >,</span> <span class="token punctuation" >{</span><span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</div>
<div class="leanpub-insert">
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>common<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>optimize<span class="token punctuation" >.</span>UglifyJsPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
        compress<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
          warnings<span class="token punctuation" >:</span> <span class="token boolean" >false</span>
        <span class="token punctuation" >}</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</div>
<span class="token punctuation" >}</span>
</code></pre>
<blockquote class="tip"><i class="icon-attention-circled"></i>Uglify warnings can help you to understand how it processes the code. Therefore it may be beneficial to have a peek at the output every once in a while.</blockquote><p>If you execute <code>npm run build</code> now, you should see better results:</p>
<pre><code class="lang-bash"><span class="token operator" >></span> webpack

Hash: ff80bbb1bdd7df271313
Version: webpack 1.12.13
Time: 9159ms
    Asset    Size  Chunks             Chunk Names
bundle.js  368 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
    + 337 hidden modules
</code></pre>
<p>Given it needs to do more work, it took longer. But on the plus side the build is much smaller now.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>It is possible to push minification further by enabling variable name mangling. It comes with some extra complexity to worry about, but it may be worth it when you are pushing for minimal size. See <a href="https://webpack.github.io/docs/list-of-plugins.html#uglifyjsplugin">the official documentation</a> for details.</blockquote><h3 class="header"><a class="header-anchor" href="#setting-process-env-node_env-" id="setting-process-env-node_env-"></a><span class="text">Setting <code>process.env.NODE_ENV</code></span><a class="header-anchor-select" href="#setting-process-env-node_env-">#</a></h3>
<p>We can perform one more step to decrease build size further. React relies on <code>process.env.NODE_ENV</code> based optimizations. If we force it to <code>production</code>, React will get built in an optimized manner. This will disable some checks (e.g., property type checks). Most importantly it will give you a smaller build and improved performance.</p>
<p>In Webpack terms, you can add the following snippet to the <code>plugins</code> section of your configuration:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>common<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
<div class="leanpub-insert">
      <span class="token comment" spellcheck="true">// Setting DefinePlugin affects React library size!</span>
      <span class="token comment" spellcheck="true">// DefinePlugin replaces content "as is" so we need some extra quotes</span>
      <span class="token comment" spellcheck="true">// for the generated code to make sense</span>
      <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>DefinePlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
        <span class="token string" >'process.env.NODE_ENV'</span><span class="token punctuation" >:</span> <span class="token string" >'"production"'</span>

        <span class="token comment" spellcheck="true">// You can set this to JSON.stringify('development') for your</span>
        <span class="token comment" spellcheck="true">// development target to force NODE_ENV to development mode</span>
        <span class="token comment" spellcheck="true">// no matter what</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>This is a useful technique for your own code. If you have a section of code that evaluates as <code>false</code> after this process, the minifier will remove it from the build completely.</p>
<p>Execute <code>npm run build</code> again, and you should see improved results:</p>
<pre><code class="lang-bash"><span class="token operator" >></span> webpack

Hash: cde2c1861fbd65f03c3b
Version: webpack 1.12.13
Time: 9032ms
    Asset    Size  Chunks             Chunk Names
bundle.js  307 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
    + 333 hidden modules
</code></pre>
<p>So we went from 1.12 MB to 368 kB, and finally, to 307 kB. The final build is a little faster than the previous one. As that 307 kB can be served gzipped, it is quite reasonable. gzipping will drop around another 40%. It is well supported by browsers.</p>
<p>We can do a little better, though. We can split <code>app</code> and <code>vendor</code> bundles and add hashes to their filenames.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i><a href="https://www.npmjs.com/package/babel-plugin-transform-inline-environment-variables">babel-plugin-transform-inline-environment-variables</a> Babel plugin can be used to achieve the same effect. See <a href="https://babeljs.io/docs/plugins/transform-inline-environment-variables/">the official documentation</a> for details.</blockquote><h2 class="header"><a class="header-anchor" href="#splitting-app-and-vendor-bundles" id="splitting-app-and-vendor-bundles"></a><span class="text">Splitting <code>app</code> and <code>vendor</code> Bundles</span><a class="header-anchor-select" href="#splitting-app-and-vendor-bundles">#</a></h2>
<p>The main advantage of splitting the application into two separate bundles is that it allows us to benefit from client caching. We might, for instance, make most of our changes to the small <code>app</code> bundle. In this case, the client would have to fetch only the <code>app</code> bundle, assuming the <code>vendor</code> bundle has already been loaded.</p>
<p>This scheme won&#39;t load as fast as a single bundle initially due to the extra request. Thanks to client-side caching, we might not need to reload all the data for every request. This is particularly true if a bundle remains unchanged. If only <code>app</code> updates, only that may need to be downloaded.</p>
<h3 class="header"><a class="header-anchor" href="#defining-a-vendor-entry-point" id="defining-a-vendor-entry-point"></a><span class="text">Defining a <code>vendor</code> Entry Point</span><a class="header-anchor-select" href="#defining-a-vendor-entry-point">#</a></h3>
<p>While developing the application, we made sure to separate our <code>dependencies</code> and <code>devDependencies</code>. This split will come in handy now. It allows us to push <code>dependencies</code> to a bundle of its own. It is very important you don&#39;t have any development related bits, such as Webpack, in that definition as then the build won&#39;t work as you might expect.</p>
<p>If you check <em>package.json</em>, the <code>dependencies</code> listed should be as follows: alt, alt-container, alt-utils, node-uuid, react, react-addons-update, react-dnd, react-dnd-html5-backend, and react-dom. In case you have some other dependencies there, move them below <code>devDependencies</code> before proceeding.</p>
<p>To get started, we need to define a <code>vendor</code> entry point. Given <em>alt-utils</em> is problematic for this kind of setup, I&#39;ve simply excluded it from the <code>vendor</code> bundle. You can use a similar idea with other problematic dependencies. Here&#39;s the setup:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> path <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'path'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >const</span> merge <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'webpack-merge'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >const</span> webpack <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'webpack'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >const</span> NpmInstallPlugin <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'npm-install-webpack-plugin'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<div class="leanpub-insert">
<span class="token comment" spellcheck="true">// Load *package.json* so we can use `dependencies` from there</span>
<span class="token keyword" >const</span> pkg <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./package.json'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</div>

<span class="token keyword" >const</span> TARGET <span class="token operator" >=</span> process<span class="token punctuation" >.</span>env<span class="token punctuation" >.</span>npm_lifecycle_event<span class="token punctuation" >;</span>
<span class="token keyword" >const</span> PATHS <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  app<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'app'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  build<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

process<span class="token punctuation" >.</span>env<span class="token punctuation" >.</span>BABEL_ENV <span class="token operator" >=</span> TARGET<span class="token punctuation" >;</span>

<span class="token keyword" >const</span> common <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    app<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  resolve<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    extensions<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >''</span><span class="token punctuation" >,</span> <span class="token string" >'.js'</span><span class="token punctuation" >,</span> <span class="token string" >'.jsx'</span><span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    path<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >,</span>
<div class="leanpub-delete">
    filename<span class="token punctuation" >:</span> <span class="token string" >'bundle.js'</span>
</div>
<div class="leanpub-insert">
    <span class="token comment" spellcheck="true">// Output using entry name</span>
    filename<span class="token punctuation" >:</span> <span class="token string" >'[name].js'</span>
</div>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>common<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
<div class="leanpub-insert">
    <span class="token comment" spellcheck="true">// Define vendor entry point needed for splitting</span>
    entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      vendor<span class="token punctuation" >:</span> Object<span class="token punctuation" >.</span><span class="token function" >keys</span><span class="token punctuation" >(</span>pkg<span class="token punctuation" >.</span>dependencies<span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >filter</span><span class="token punctuation" >(</span><span class="token keyword" >function</span><span class="token punctuation" >(</span>v<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token comment" spellcheck="true">// Exclude alt-utils as it won't work with this setup</span>
        <span class="token comment" spellcheck="true">// due to the way the package has been designed</span>
        <span class="token comment" spellcheck="true">// (no package.json main).</span>
        <span class="token keyword" >return</span> v <span class="token operator" >!==</span> <span class="token string" >'alt-utils'</span><span class="token punctuation" >;</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</div>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>This tells Webpack that we want a separate <em>entry chunk</em> for our project <code>vendor</code> level dependencies.</p>
<p>Beyond this, it&#39;s possible to define chunks that are loaded dynamically. This can be achieved through <a href="https://webpack.github.io/docs/code-splitting.html">require.ensure</a>.</p>
<p>If you execute the build now using <code>npm run build</code>, you should see something along this:</p>
<pre><code class="lang-bash"><span class="token operator" >></span> webpack

Hash: 192a0643b9245a61a6e0
Version: webpack 1.12.13
Time: 14745ms
    Asset    Size  Chunks             Chunk Names
   app.js  307 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
vendor.js  286 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
   <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> multi vendor 112 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
    + 333 hidden modules
</code></pre>
<p>Now we have separate <em>app</em>  and <em>vendor</em> bundles. There&#39;s something wrong, however. If you examine the files, you&#39;ll see that <em>app.js</em> contains <em>vendor</em> dependencies. We need to do something to tell Webpack to avoid this situation. This is where <code>CommonsChunkPlugin</code> comes in.</p>
<h3 class="header"><a class="header-anchor" href="#setting-up-commonschunkplugin-" id="setting-up-commonschunkplugin-"></a><span class="text">Setting Up <code>CommonsChunkPlugin</code></span><a class="header-anchor-select" href="#setting-up-commonschunkplugin-">#</a></h3>
<p><code>CommonsChunkPlugin</code> allows us to extract the code we need for the <code>vendor</code> bundle. In addition, we will use it to extract a <em>manifest</em>. It is a file that tells Webpack how to map each module to each file. We will need this in the next step for setting up long term caching. Here&#39;s the setup:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>common<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    <span class="token comment" spellcheck="true">// Define vendor entry point needed for splitting</span>
    entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
<div class="leanpub-insert">
      <span class="token comment" spellcheck="true">// Extract vendor and manifest files</span>
      <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>optimize<span class="token punctuation" >.</span>CommonsChunkPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
        names<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'vendor'</span><span class="token punctuation" >,</span> <span class="token string" >'manifest'</span><span class="token punctuation" >]</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>If you run <code>npm run build</code> now, you should see output as below:</p>
<pre><code class="lang-bash"><span class="token operator" >></span> webpack

Hash: 3a08642b633ebeafa62f
Version: webpack 1.12.13
Time: 11044ms
      Asset       Size  Chunks             Chunk Names
     app.js    21.3 kB    0, 2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
  vendor.js     286 kB    1, 2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
manifest.js  743 bytes       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  manifest
   <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> multi vendor 112 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
    + 333 hidden modules
</code></pre>
<p>The situation is far better now. Note how small <code>app</code> bundle compared to the <code>vendor</code> bundle. In order to really benefit from this split, we should set up caching. This can be achieved by adding cache busting hashes to filenames.</p>
<h3 class="header"><a class="header-anchor" href="#adding-hashes-to-filenames" id="adding-hashes-to-filenames"></a><span class="text">Adding Hashes to Filenames</span><a class="header-anchor-select" href="#adding-hashes-to-filenames">#</a></h3>
<p>Webpack provides placeholders that can be used to access different types of hashes and entry name as we saw before. The most useful ones are:</p>
<ul>
<li><code>[name]</code> - Returns entry name.</li>
<li><code>[hash]</code> - Returns build hash.</li>
<li><code>[chunkhash]</code> - Returns a chunk specific hash.</li>
</ul>
<p>Using these placeholders you could end up with filenames, such as:</p>
<pre><code class="lang-bash">app.d587bbd6e38337f5accd.js
vendor.dc746a5db4ed650296e1.js
</code></pre>
<p>If the file contents are different, the hash will change as well, thus invalidating the cache, or more accurately the browser will send a new request for the new file. This means if only <code>app</code> bundle gets updated, only that file needs to be requested again.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>An alternative way to achieve the same would be to generate static filenames and invalidate the cache through a querystring (i.e., <code>app.js?d587bbd6e38337f5accd</code>). The part behind the question mark will invalidate the cache. This method is not recommended. According to <a href="http://www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/">Steve Souders</a>, attaching the hash to the filename is a more performant way to go.</blockquote><p>We can use the placeholder idea within our configuration like this:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>common<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    <span class="token comment" spellcheck="true">// Define vendor entry point needed for splitting</span>
    entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
    output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      path<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >,</span>
      filename<span class="token punctuation" >:</span> <span class="token string" >'[name].[chunkhash].js'</span><span class="token punctuation" >,</span>
      chunkFilename<span class="token punctuation" >:</span> <span class="token string" >'[chunkhash].js'</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</div>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>If you execute <code>npm run build</code> now, you should see output like this.</p>
<pre><code class="lang-bash"><span class="token operator" >></span> webpack

Hash: 7ddb226a34540aa401bc
Version: webpack 1.12.13
Time: 8741ms
                           Asset       Size  Chunks             Chunk Names
     app.5b758fea66f30faf0f0e.js    21.3 kB    0, 2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
  vendor.db9a3343cf47e4b3d83c.js     286 kB    1, 2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
manifest.19a8a5985bb61f546ce3.js  763 bytes       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  manifest
   <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> multi vendor 112 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
    + 333 hidden modules
</code></pre>
<p>Our files have neat hashes now. To prove that it works, you could try altering <em>app/index.jsx</em> and include a <code>console.log</code> there. After you build, only <code>app</code> and <code>manifest</code> related bundles should change.</p>
<p>One more way to improve the build further would be to load popular dependencies, such as React, through a CDN. That would decrease the size of the vendor bundle even further while adding an external dependency on the project. The idea is that if the user has hit the CDN earlier, caching can kick in just like here.</p>
<h2 class="header"><a class="header-anchor" href="#generating-index-html-through-html-webpack-plugin-" id="generating-index-html-through-html-webpack-plugin-"></a><span class="text">Generating <em>index.html</em> through <em>html-webpack-plugin</em></span><a class="header-anchor-select" href="#generating-index-html-through-html-webpack-plugin-">#</a></h2>
<p>Even though we have fine bundles now, there&#39;s one problem. Our current <em>index.html</em> doesn&#39;t point to them correctly. We could write the script tags we need by hand, but fortunately there are better ways. One option would be to trigger Webpack through its <a href="https://webpack.github.io/docs/node.js-api.html">Node.js API</a>. The build output its API provides contains the asset names we need. After that we could apply those to some template.</p>
<p>A good alternative is to use a Webpack plugin and a template that have been designed for this purpose. <a href="https://www.npmjs.com/package/html-webpack-plugin">html-webpack-plugin</a> and <a href="https://www.npmjs.com/package/html-webpack-template">html-webpack-template</a> work well together and can perform a lot of the heavy lifting for us. Install them first:</p>
<pre><code class="lang-bash">npm i html-webpack-plugin html-webpack-template --save-dev
</code></pre>
<p>In order to connect it with our project, we need to tweak the configuration a notch. While at it, get rid of <em>build/index.html</em> as we won&#39;t need that anymore. The system will generate it for us after this step:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<div class="leanpub-insert">
<span class="token keyword" >const</span> HtmlWebpackPlugin <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'html-webpack-plugin'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</div>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >const</span> common <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
  module<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<div class="leanpub-delete">
  <span class="token punctuation" >}</span>
</div>
<div class="leanpub-insert">
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
    <span class="token keyword" >new</span> <span class="token class-name" >HtmlWebpackPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
      template<span class="token punctuation" >:</span> <span class="token string" >'node_modules/html-webpack-template/index.ejs'</span><span class="token punctuation" >,</span>
      title<span class="token punctuation" >:</span> <span class="token string" >'Kanban app'</span><span class="token punctuation" >,</span>
      appMountId<span class="token punctuation" >:</span> <span class="token string" >'app'</span><span class="token punctuation" >,</span>
      inject<span class="token punctuation" >:</span> <span class="token boolean" >false</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
  <span class="token punctuation" >]</span>
</div>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'start'</span> <span class="token operator" >||</span> <span class="token operator" >!</span>TARGET<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>common<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    devtool<span class="token punctuation" >:</span> <span class="token string" >'eval-source-map'</span><span class="token punctuation" >,</span>
    devServer<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
<div class="leanpub-delete">
      contentBase<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >,</span>
</div>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>HotModuleReplacementPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      <span class="token keyword" >new</span> <span class="token class-name" >NpmInstallPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
        save<span class="token punctuation" >:</span> <span class="token boolean" >true</span> <span class="token comment" spellcheck="true">// --save</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
</code></pre>
<p>If you execute <code>npm run build</code> now, the output should include <em>index.html</em>:</p>
<pre><code class="lang-bash"><span class="token operator" >></span> webpack

Hash: 7ddb226a34540aa401bc
Version: webpack 1.12.13
Time: 9200ms
                           Asset       Size  Chunks             Chunk Names
     app.5b758fea66f30faf0f0e.js    21.3 kB    0, 2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
  vendor.db9a3343cf47e4b3d83c.js     286 kB    1, 2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
manifest.19a8a5985bb61f546ce3.js  763 bytes       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  manifest
                      index.html  648 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> multi vendor 112 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
    + 333 hidden modules
Child html-webpack-plugin <span class="token keyword" >for</span> <span class="token string" >"index.html"</span><span class="token keyword" >:</span>
        + 3 hidden modules
</code></pre>
<p>Even though this adds some configuration to our project, we don&#39;t have to worry about gluing things together now. If more flexibility is needed, it&#39;s possible to implement a custom template.</p>
<h2 class="header"><a class="header-anchor" href="#cleaning-the-build" id="cleaning-the-build"></a><span class="text">Cleaning the Build</span><a class="header-anchor-select" href="#cleaning-the-build">#</a></h2>
<p>Our current setup doesn&#39;t clean the <code>build</code> directory between builds. As this can get annoying if we change our setup, we can use a plugin to clean the directory for us. Install the plugin and change the build configuration as follows to integrate it:</p>
<pre><code class="lang-bash">npm i clean-webpack-plugin --save-dev
</code></pre>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<div class="leanpub-insert">
<span class="token keyword" >const</span> CleanPlugin <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'clean-webpack-plugin'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</div>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>common<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
<div class="leanpub-insert">
      <span class="token keyword" >new</span> <span class="token class-name" >CleanPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>After this change, our <code>build</code> directory should remain nice and tidy when building. See <a href="https://www.npmjs.com/package/clean-webpack-plugin">clean-webpack-plugin</a> for further options.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you want to preserve possible dotfiles within your build directory, you can use <code>[path.join(PATHS.build, &#39;/*&#39;)]</code> instead of <code>[PATHS.build]</code>.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>An alternative would be to use your terminal (<code>rm -rf ./build/</code>) and set that up in the <code>scripts</code> section of <em>package.json</em>.</blockquote><h2 class="header"><a class="header-anchor" href="#separating-css" id="separating-css"></a><span class="text">Separating CSS</span><a class="header-anchor-select" href="#separating-css">#</a></h2>
<p>Even though we have a nice build set up now, where did all the CSS go? As per our configuration, it has been inlined to JavaScript! Even though this can be convenient during development, it doesn&#39;t sound ideal. The current solution doesn&#39;t allow us to cache CSS. In some cases we might suffer from a flash of unstyled content (FOUC).</p>
<p>It just so happens that Webpack provides a means to generate a separate CSS bundle. We can achieve this using the <a href="https://www.npmjs.com/package/extract-text-webpack-plugin">ExtractTextPlugin</a>. It comes with overhead during the compilation phase, and it won&#39;t work with Hot Module Replacement (HMR) by design. Given we are using it only for production, that won&#39;t be a problem.</p>
<p>It will take some configuration to make it work. Execute</p>
<pre><code class="lang-bash">npm i extract-text-webpack-plugin --save-dev
</code></pre>
<p>to get started. Next, we need to get rid of our current CSS related declaration at <code>common</code> configuration. After that, we need to split it up between <code>build</code> and <code>dev</code> configuration sections as follows:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<div class="leanpub-insert">
<span class="token keyword" >const</span> ExtractTextPlugin <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'extract-text-webpack-plugin'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</div>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >const</span> common <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    app<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  resolve<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    extensions<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >''</span><span class="token punctuation" >,</span> <span class="token string" >'.js'</span><span class="token punctuation" >,</span> <span class="token string" >'.jsx'</span><span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  module<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    loaders<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
<div class="leanpub-delete">
      <span class="token punctuation" >{</span>
        <span class="token comment" spellcheck="true">// Test expects a RegExp! Note the slashes!</span>
        test<span class="token punctuation" >:</span> <span class="token regex" >/\.css$/</span><span class="token punctuation" >,</span>
        loaders<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'style'</span><span class="token punctuation" >,</span> <span class="token string" >'css'</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span>
        <span class="token comment" spellcheck="true">// Include accepts either a path or an array of paths.</span>
        include<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app
      <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</div>
      <span class="token punctuation" >{</span>
        test<span class="token punctuation" >:</span> <span class="token regex" >/\.jsx?$/</span><span class="token punctuation" >,</span>
        loaders<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'babel?cacheDirectory'</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span>
        include<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app
      <span class="token punctuation" >}</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
    <span class="token keyword" >new</span> <span class="token class-name" >HtmlWebpackPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
      template<span class="token punctuation" >:</span> <span class="token string" >'node_modules/html-webpack-template/index.html'</span><span class="token punctuation" >,</span>
      title<span class="token punctuation" >:</span> <span class="token string" >'Kanban app'</span><span class="token punctuation" >,</span>
      appMountId<span class="token punctuation" >:</span> <span class="token string" >'app'</span><span class="token punctuation" >,</span>
      inject<span class="token punctuation" >:</span> <span class="token boolean" >false</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
  <span class="token punctuation" >]</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'start'</span> <span class="token operator" >||</span> <span class="token operator" >!</span>TARGET<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>common<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    devtool<span class="token punctuation" >:</span> <span class="token string" >'eval-source-map'</span><span class="token punctuation" >,</span>
    devServer<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
    module<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      loaders<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
        <span class="token comment" spellcheck="true">// Define development specific CSS setup</span>
        <span class="token punctuation" >{</span>
          test<span class="token punctuation" >:</span> <span class="token regex" >/\.css$/</span><span class="token punctuation" >,</span>
          loaders<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'style'</span><span class="token punctuation" >,</span> <span class="token string" >'css'</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span>
          include<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app
        <span class="token punctuation" >}</span>
      <span class="token punctuation" >]</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</div>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>common<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
    module<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      loaders<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
        <span class="token comment" spellcheck="true">// Extract CSS during build</span>
        <span class="token punctuation" >{</span>
          test<span class="token punctuation" >:</span> <span class="token regex" >/\.css$/</span><span class="token punctuation" >,</span>
          loader<span class="token punctuation" >:</span> ExtractTextPlugin<span class="token punctuation" >.</span><span class="token function" >extract</span><span class="token punctuation" >(</span><span class="token string" >'style'</span><span class="token punctuation" >,</span> <span class="token string" >'css'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
          include<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app
        <span class="token punctuation" >}</span>
      <span class="token punctuation" >]</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</div>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token keyword" >new</span> <span class="token class-name" >CleanPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >]</span><span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
        verbose<span class="token punctuation" >:</span> <span class="token boolean" >false</span> <span class="token comment" spellcheck="true">// Don't write logs to console</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
      <span class="token comment" spellcheck="true">// Output extracted CSS to a file</span>
      <span class="token keyword" >new</span> <span class="token class-name" >ExtractTextPlugin</span><span class="token punctuation" >(</span><span class="token string" >'[name].[chunkhash].css'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
      <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>Using this setup, we can still benefit from the HMR during development. For a production build, we generate a separate CSS. <em>html-webpack-plugin</em> will pick it up automatically and inject it into our <code>index.html</code>.</p>
<blockquote class="warning"><i class="icon-attention"></i>Definitions, such as <code>loaders: [ExtractTextPlugin.extract(&#39;style&#39;, &#39;css&#39;)]</code>, won&#39;t work and will cause the build to error instead! So when using <code>ExtractTextPlugin</code>, use the <code>loader</code> form instead.</blockquote><blockquote class="warning"><i class="icon-attention"></i>If you want to pass more loaders to the <code>ExtractTextPlugin</code>, you should use <code>!</code> syntax. Example: <code>ExtractTextPlugin.extract(&#39;style&#39;, &#39;css!postcss&#39;)</code>.</blockquote><p>After running <code>npm run build</code>, you should see output similar to the following:</p>
<pre><code class="lang-bash"><span class="token operator" >></span> webpack

clean-webpack-plugin: <span class="token punctuation" >..</span>./kanban_app/build has been removed.
Hash: 32b800b64e76fbd5d447
Version: webpack 1.12.13
Time: 9125ms
                           Asset       Size  Chunks             Chunk Names
     app.341186f43191211bee0c.js    16.5 kB    0, 2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
  vendor.db9a3343cf47e4b3d83c.js     286 kB    1, 2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
manifest.c3a4ec998b7ccca9268f.js  763 bytes       2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  manifest
    app.341186f43191211bee0c.css    1.16 kB    0, 2  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
                      index.html  713 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> multi vendor 112 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
    + 333 hidden modules
Child html-webpack-plugin <span class="token keyword" >for</span> <span class="token string" >"index.html"</span><span class="token keyword" >:</span>
        + 3 hidden modules
Child extract-text-webpack-plugin:
        + 2 hidden modules
</code></pre>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you are getting <code>Module build failed: CssSyntaxError:</code> error, make sure your <code>common</code> configuration doesn&#39;t have a CSS related section set up!</blockquote><p>Now our styling has been pushed to a separate CSS file. As a result, our JavaScript bundles have become slightly smaller. We also avoid the FOUC problem. The browser doesn&#39;t have to wait for JavaScript to load to get styling information. Instead, it can process CSS separately avoiding flash of unstyled content (FOUC).</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you have a complex project with a lot of dependencies, it is likely a good idea to use the <code>DedupePlugin</code>. It will find possible duplicate files and deduplicate them. Use <code>new webpack.optimize.DedupePlugin()</code> in your plugins definition to enable it.</blockquote><h3 class="header"><a class="header-anchor" href="#improving-caching-behavior" id="improving-caching-behavior"></a><span class="text">Improving Caching Behavior</span><a class="header-anchor-select" href="#improving-caching-behavior">#</a></h3>
<p>There is one slight problem with the current approach. The generated <code>app.js</code> and <code>app.css</code> belong to the same chunk. This means that if the contents associated JavaScript or CSS change, so do the hashes. This isn&#39;t ideal as it can invalidate our cache even if we don&#39;t want it to.</p>
<p>One way to solve this issue is to push styling to a chunk of its own. This breaks the dependency and fixes caching. To achieve this we need to decouple styling from it current chunk and define a custom chunk for it through configuration:</p>
<p><strong>app/index.jsx</strong></p>
<pre><code class="lang-javascript"><div class="leanpub-delete">
<span class="token keyword" >import</span> <span class="token string" >'./main.css'</span><span class="token punctuation" >;</span>
</div>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
</code></pre>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >const</span> PATHS <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  app<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'app'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
<div class="leanpub-delete">
  build<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span>
</div>
<div class="leanpub-insert">
  build<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  style<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'app/main.css'</span><span class="token punctuation" >)</span>
</div>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >const</span> common <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
<div class="leanpub-delete">
    app<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app
</div>
<div class="leanpub-insert">
    app<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app<span class="token punctuation" >,</span>
    style<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>style
</div>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
</code></pre>
<p>If you build the project now through <code>npm run build</code>, you should see something like this:</p>
<pre><code class="lang-bash">Hash: 22e7d6f1b15400035cbb
Version: webpack 1.12.13
Time: 9271ms
                           Asset       Size  Chunks             Chunk Names
     app.5d41daf72705cb65cd89.js    16.4 kB    0, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
   style.0688e2aa1fa6c618dcdd.js   38 bytes    1, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  style
  vendor.ec174332c803122d2dba.js     286 kB    2, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
manifest.035b449d16a98df2cb4f.js  788 bytes       3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  manifest
  style.0688e2aa1fa6c618dcdd.css    1.16 kB    1, 3  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  style
                      index.html  770 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> multi vendor 112 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
    + 333 hidden modules
Child html-webpack-plugin <span class="token keyword" >for</span> <span class="token string" >"index.html"</span><span class="token keyword" >:</span>
        + 3 hidden modules
Child extract-text-webpack-plugin:
        + 2 hidden modules
</code></pre>
<p>After this step we have managed to separate styling from JavaScript. Changes made to it shouldn&#39;t affect JavaScript chunk hashes or vice versa. The approach comes with a small glitch, though. If you look closely, you can see a file named <em>style.64acd61995c3afbc43f1.js</em>. It is a file generated by Webpack and it looks like this:</p>
<pre><code class="lang-javascript"><span class="token function" >webpackJsonp</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span><span class="token number" >1</span><span class="token punctuation" >,</span><span class="token number" >3</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span><span class="token punctuation" >[</span><span class="token keyword" >function</span><span class="token punctuation" >(</span>n<span class="token punctuation" >,</span>c<span class="token punctuation" >)</span><span class="token punctuation" >{</span><span class="token punctuation" >}</span><span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>Technically it&#39;s redundant. It would be safe to exclude the file through a check at <em>HtmlWebpackPlugin</em> template. But this solution is good enough for the project. Ideally Webpack shouldn&#39;t generate these files at all.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>In the future we might be able to avoid this problem by using <code>[contenthash]</code> placeholder. It&#39;s generated based on file content (i.e., CSS in this case). Unfortunately it doesn&#39;t work as expected when the file is included in a chunk as in our original setup. This issue has been reported as <a href="https://github.com/webpack/webpack/issues/672">Webpack issue #672</a>.</blockquote><h2 class="header"><a class="header-anchor" href="#analyzing-build-statistics" id="analyzing-build-statistics"></a><span class="text">Analyzing Build Statistics</span><a class="header-anchor-select" href="#analyzing-build-statistics">#</a></h2>
<p>Analyzing build statistics is a good step towards understanding Webpack better. We can get statistics from it easily and we can visualize them using a tool. This shows us the composition of our bundles.</p>
<p>In order to get suitable output we&#39;ll need to do a couple of tweaks to our configuration:</p>
<p><strong>package.json</strong></p>
<pre><code class="lang-json"><span class="token punctuation" >{</span>
  ...
  <span class="token property" >"scripts"</span><span class="token operator" >:</span> <span class="token punctuation" >{</span>
<div class="leanpub-insert">
    <span class="token property" >"stats"</span><span class="token operator" >:</span> <span class="token string" >"webpack --profile --json > stats.json"</span><span class="token punctuation" >,</span>
</div>
    ...
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  ...
<span class="token punctuation" >}</span>
</code></pre>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<div class="leanpub-delete">
<span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
</div>
<div class="leanpub-insert">
<span class="token keyword" >if</span><span class="token punctuation" >(</span>TARGET <span class="token operator" >===</span> <span class="token string" >'build'</span> <span class="token operator" >||</span> TARGET <span class="token operator" >===</span> <span class="token string" >'stats'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
</div>
  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
</code></pre>
<p>If you execute <code>npm run stats</code> now, you should find <em>stats.json</em> at your project root after it has finished processing. We can take this file and pass it to <a href="http://webpack.github.io/analyse/">the online tool</a>. Note that the tool works only over HTTP! If your data is sensitive, consider using <a href="https://github.com/webpack/analyse">the standalone version</a> instead.</p>
<p>Besides helping you to understand your bundle composition, the tool can help you to optimize your output further.</p>
<h2 class="header"><a class="header-anchor" href="#deployment" id="deployment"></a><span class="text">Deployment</span><a class="header-anchor-select" href="#deployment">#</a></h2>
<p>There&#39;s no one right way to deploy our application. <code>npm run build</code> provides us something static to host. If you drop that on a suitable server, it will just work. One neat way to deal with it for small demos is to piggyback on GitHub Pages.</p>
<h3 class="header"><a class="header-anchor" href="#hosting-on-github-pages" id="hosting-on-github-pages"></a><span class="text">Hosting on GitHub Pages</span><a class="header-anchor-select" href="#hosting-on-github-pages">#</a></h3>
<p>A package known as <a href="https://www.npmjs.com/package/gh-pages">gh-pages</a> allows us to achieve this easily. You point it to your build directory first. It will then pick up the contents and push them to the <code>gh-pages</code> branch. To get started, execute</p>
<pre><code class="lang-bash">npm i gh-pages --save-dev
</code></pre>
<p>We are also going to need an entry point at <em>package.json</em>:</p>
<p><strong>package.json</strong></p>
<pre><code class="lang-json"><span class="token punctuation" >{</span>
  ...
  <span class="token property" >"scripts"</span><span class="token operator" >:</span> <span class="token punctuation" >{</span>
<div class="leanpub-insert">
    <span class="token property" >"deploy"</span><span class="token operator" >:</span> <span class="token string" >"gh-pages -d build"</span><span class="token punctuation" >,</span>
</div>
    ...
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  ...
<span class="token punctuation" >}</span>
</code></pre>
<p>If you execute <code>npm run deploy</code> now and everything goes fine, you should have your application hosted through GitHub Pages. You should find it at <code>https://&lt;name&gt;.github.io/&lt;project&gt;</code> (<em>github.com/<name>/<project></em> at GitHub) assuming it worked.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>If you need a more elaborate setup, you can use the Node.js API that <em>gh-pages</em> provides. The default CLI tool it provides is often enough, though.</blockquote><h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Beyond the features discussed, Webpack allows you to <a href="https://webpack.github.io/docs/code-splitting.html">lazy load</a> content through <code>require.ensure</code>. This is handy if you happen to have a specific dependency on some view and want to load it when you need it.</p>
<p>Our Kanban application is now ready to be served. We went from a chunky build to a slim one. Even better the production version can benefit from caching and it is able to invalidate it.</p>
<p>If you wanted to develop the project further, it could be a good idea to rethink the project structure. I&#39;ve discussed the topic at the <em>Structuring React Projects</em> appendix. It can be beneficial to read the <em>Authoring Packages</em> chapter for more ideas on how to improve the npm setup of your project.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/dnd.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack_react/implementing_dnd">Implementing Drag and Drop</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/skydiving.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack_react/advanced">Advanced Techniques</a></div></div><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Advanced Techniques" href="/webpack_react/advanced"><i class="icon-right-open"></i></a><a class="previous-page" title="Implementing Drag and Drop" href="/webpack_react/implementing_dnd"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs_webpack">Buy the full ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><div class="right ribbon github-fork-ribbon-wrapper"><div class="github-fork-ribbon" style="background-color:black;"><a href="https://github.com/survivejs/webpack_react/issues/new?title=Building Kanban - " target="_blank">Submit feedback</a></div></div><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs/webpack_react" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs/webpack_react" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/react-rocks-interview">React.rocks - React Components and Demos - Interview with Jeff Winkler</a></li><li><a class="blog-teaser" href="/blog/reindex-interview">Reindex - Instant GraphQL Backend for Your React Apps - Interview with Ville Immonen</a></li><li><a class="blog-teaser" href="/blog/survivejs-interview">SurviveJS - Learn Webpack and React - Interview with Juho Vepsäläinen</a></li><li><a class="blog-teaser" href="/blog/styleguidist-interview">react-styleguidist - Style guide generator for React - Interview with Artem Sapegin</a></li><li><a class="blog-teaser" href="/blog/survivejs200">SurviveJS - Webpack and React - v2.0.0</a></li><li><a class="blog-teaser" href="/blog/survivejs200-rc4">SurviveJS - Webpack and React - v2.0.0-rc4</a></li><li><a class="blog-teaser" href="/blog/towards-common-components">Towards a Common Component Definition</a></li><li><a class="blog-teaser" href="/blog/survivejs200-rc3">SurviveJS - Webpack and React - v2.0.0-rc3</a></li><li><a class="blog-teaser" href="/blog/survivejs200-rc2">SurviveJS - Webpack and React - v2.0.0-rc2</a></li><li><a class="blog-teaser" href="/blog/survivejs200-rc1">SurviveJS - Webpack and React - v2.0.0-rc1</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack_react'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div></main></body></html>