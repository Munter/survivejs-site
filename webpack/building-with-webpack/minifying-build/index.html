<html lang="en"><head><title>SurviveJS - Minifying the Build</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
So far we haven&#x27;t given thought to our build output and no doubt it&#x27;s going to be a little chunky, especially as we include React in it. We can apply a variety of techniques to bring down the size of it. We can also leverage client level caching and load certain assets lazily. I&#x27;ll discuss the lattâ€¦"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="./atom.xml"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/production.jpg);"></div><h1 class="post__heading">Minifying the Build</h1><div class="header-extra"><a href="https://pixabay.com/en/electric-electricity-building-1080584/">jarmoluk (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/webpack-compared">Webpack Compared</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing-with-webpack">Developing with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/splitting-configuration">Splitting the Configuration</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/refreshing-css">Refreshing CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/enabling-sourcemaps">Enabling Sourcemaps</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building-with-webpack">Building with Webpack</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Minifying the Build</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/setting-environment-variables">Setting Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/splitting-bundles">Splitting Bundles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/cleaning-build">Cleaning the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/hosting-on-github-pages">Hosting on GitHub Pages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading-assets">Loading Assets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/formats-supported">Formats Supported</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-styles">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-fonts">Loading Fonts</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/advanced-techniques">Advanced Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/understanding-chunks">Understanding Chunks</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/linting">Linting in Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/authoring-packages">Authoring Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/writing-loaders">Writing Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/configuring-react">Configuring React</a></li></ul><div><div class="buy-container"><a href="/webpack/introduction"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/mikey-interview">Mikey - React/Redux CLI/Framework - Interview with Michael Farrell</a></blockquote><div class="chapter-content"><p>So far we haven&#39;t given thought to our build output and no doubt it&#39;s going to be a little chunky, especially as we include React in it. We can apply a variety of techniques to bring down the size of it. We can also leverage client level caching and load certain assets lazily. I&#39;ll discuss the latter topic in the <em>Understanding Chunks</em> chapter later on.</p>
<p>The first of these techniques is known as minification. It is a process where code is simplified without losing any meaning that matters to the interpreter. As a result your code will most likely look quite jumbled and it will be hard to read. But that&#39;s the point.</p>
<p>When certain aggressive minification techniques are applied, sometimes even the meaning of the resulting code may change. This is the reason why certain frameworks apply certain countermeasures against excessive minification. You can see this in Angular 1 definitions for example.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Even if we minify our build, we can still generate sourcemaps through the <code>devtool</code> option we discussed earlier. This will give us better means to debug even production code.</blockquote><h2 class="header"><a class="header-anchor" href="#generating-a-baseline-build" id="generating-a-baseline-build"></a><span class="text">Generating a Baseline Build</span><a class="header-anchor-select" href="#generating-a-baseline-build">#</a></h2>
<p>To get started, we should generate a baseline build so we have something to optimize. Given our project is so small, there isn&#39;t much to optimize yet. We could bring a heavy dependency like React to get something to slim up. Install React first:</p>
<pre><code class="lang-bash">npm i react --save
</code></pre>
<p>We also need to make our project depend on it:</p>
<p><strong>app/index.js</strong></p>
<pre><code><div class="leanpub-insert">
require<span class="token punctuation" >(</span><span class="token string" >'react'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</div>

<span class="token punctuation" >..</span>.
</code></pre><p>Now that we have something to optimize, execute <code>npm run build</code>. You should end up with something like this:</p>
<pre><code class="lang-bash"><span class="token punctuation" >[</span>webpack-validator<span class="token punctuation" >]</span> Config is valid.
Hash: dde0419cac0674732a83
Version: webpack 1.13.0
Time: 1730ms
     Asset       Size  Chunks             Chunk Names
    app.js     133 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
app.js.map     157 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
index.html  157 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./app/index.js 123 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>37<span class="token punctuation" >]</span> ./app/component.js 136 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
    + 36 hidden modules
Child html-webpack-plugin <span class="token keyword" >for</span> <span class="token string" >"index.html"</span><span class="token keyword" >:</span>
        + 3 hidden modules
</code></pre>
<p>133 kB is a lot! Minification should bring down the size a lot.</p>
<h2 class="header"><a class="header-anchor" href="#minifying-the-code" id="minifying-the-code"></a><span class="text">Minifying the Code</span><a class="header-anchor-select" href="#minifying-the-code">#</a></h2>
<p>Minification will convert our code into a smaller format without losing any meaning. Usually this means some amount of rewriting code through predefined transformations. Sometimes, this can break code as it can rewrite pieces of code you inadvertently depend upon.</p>
<p>The easiest way to enable minification is to call <code>webpack -p</code> (<code>-p</code> as in <code>production</code>). Alternatively, we can use a plugin directly as this provides us more control. By default Uglify will output a lot of warnings and they don&#39;t provide value in this case, we&#39;ll be disabling them.</p>
<p>As earlier, we can define a little function for this purpose and then point to it from our main configuration. Here&#39;s the basic idea:</p>
<p><strong>lib/parts.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<div class="leanpub-insert">
exports<span class="token punctuation" >.</span>minify <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> <span class="token punctuation" >{</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>optimize<span class="token punctuation" >.</span>UglifyJsPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
        compress<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
          warnings<span class="token punctuation" >:</span> <span class="token boolean" >false</span>
        <span class="token punctuation" >}</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</div>
</code></pre>
<p>Now we can hook it up with our configuration like this:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token comment" spellcheck="true">// Detect how npm is run and branch based on that</span>
<span class="token keyword" >switch</span><span class="token punctuation" >(</span>process<span class="token punctuation" >.</span>env<span class="token punctuation" >.</span>npm_lifecycle_event<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >case</span> <span class="token string" >'build'</span><span class="token punctuation" >:</span>
    config <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>
      common<span class="token punctuation" >,</span>
<div class="leanpub-insert">
      parts<span class="token punctuation" >.</span><span class="token function" >minify</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
      parts<span class="token punctuation" >.</span><span class="token function" >setupCSS</span><span class="token punctuation" >(</span>PATHS<span class="token punctuation" >.</span>style<span class="token punctuation" >)</span>
    <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token keyword" >break</span><span class="token punctuation" >;</span>
  <span class="token keyword" >default</span><span class="token punctuation" >:</span>
    <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token function" >validate</span><span class="token punctuation" >(</span>config<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>If you execute <code>npm run build</code> now, you should see better results:</p>
<pre><code class="lang-bash"><span class="token punctuation" >[</span>webpack-validator<span class="token punctuation" >]</span> Config is valid.
Hash: aec016ce2e9d0dfa1577
Version: webpack 1.13.0
Time: 3342ms
     Asset       Size  Chunks             Chunk Names
    app.js      38 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
app.js.map     325 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
index.html  157 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./app/index.js 123 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
  <span class="token punctuation" >[</span>37<span class="token punctuation" >]</span> ./app/component.js 136 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
    + 36 hidden modules
Child html-webpack-plugin <span class="token keyword" >for</span> <span class="token string" >"index.html"</span><span class="token keyword" >:</span>
        + 3 hidden modules
</code></pre>
<p>Given it needs to do more work, it took longer. But on the plus side the build is significantly smaller now.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Uglify warnings can help you to understand how it processes the code. Therefore it may be beneficial to have a peek at the full output every once in a while.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>It is possible to push minification further by enabling variable name mangling. It comes with some extra complexity to worry about, but it may be worth it when you are pushing for minimal size. See <a href="https://webpack.github.io/docs/list-of-plugins.html#uglifyjsplugin">the official documentation</a> for details.</blockquote><h2 class="header"><a class="header-anchor" href="#uglifyjs-specific-options" id="uglifyjs-specific-options"></a><span class="text">UglifyJS Specific Options</span><a class="header-anchor-select" href="#uglifyjs-specific-options">#</a></h2>
<p><a href="http://lisperator.net/uglifyjs/">UglifyJS</a> is a powerful tool and it provides advanced options you can consider using if you want to push your build further. One useful option is known as <code>mangle</code>. It will reduce local variable names to a minimum, usually a single character. It can also rewrite properties to a more compact format. Given these transformations can break your code, be careful.</p>
<p>Here&#39;s how you would enable property mangling through Webpack:</p>
<pre><code class="lang-javascript"><span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>optimize<span class="token punctuation" >.</span>UglifyJsPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
  compress<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    warnings<span class="token punctuation" >:</span> <span class="token boolean" >false</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  mangle<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    <span class="token comment" spellcheck="true">// Mangle matching properties</span>
    props<span class="token punctuation" >:</span> <span class="token regex" >/matching_props/</span><span class="token punctuation" >,</span>
    <span class="token comment" spellcheck="true">// Don't mangle these</span>
    except<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token string" >'Array'</span><span class="token punctuation" >,</span> <span class="token string" >'BigInteger'</span><span class="token punctuation" >,</span> <span class="token string" >'Boolean'</span><span class="token punctuation" >,</span> <span class="token string" >'Buffer'</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span>
</code></pre>
<p>You can also enable features, such as dropping logging, through further configuration. <code>console</code> statements could be dropped by setting <code>compress.drop_console: true</code>. UglifyJS documentation contains more ideas like these.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Dropping the <code>console</code> statements can be achieved through Babel too by using the <a href="https://www.npmjs.com/package/babel-plugin-remove-console">babel-plugin-remove-console</a> plugin.</blockquote><h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Even though our build is a little better now, there&#39;s still a fair amount of work left. The next simple step is to set an environment variable during the build to allow React to optimize itself. This technique can be used in your own code as well. You might want to skip certain checks in production usage and so on to bring the build size down.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/machine.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/building-with-webpack">Building with Webpack</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/firewood.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/building-with-webpack/setting-environment-variables">Setting Environment Variables</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Setting Environment Variables" href="/webpack/building-with-webpack/setting-environment-variables"><i class="icon-right-open"></i></a><a class="previous-page" title="Building with Webpack" href="/webpack/building-with-webpack"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><div class="right ribbon github-fork-ribbon-wrapper"><div class="github-fork-ribbon" style="background-color:black;"><a href="https://github.com/survivejs/webpack/issues/new?title=Minifying the Build - " target="_blank">Submit feedback</a></div></div><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/mikey-interview">Mikey - React/Redux CLI/Framework - Interview with Michael Farrell</a></li><li><a class="blog-teaser" href="/blog/survivejs-react-253">SurviveJS - React - v2.5.3</a></li><li><a class="blog-teaser" href="/blog/builder-interview">Builder - A npm-based task runner - Interview with Ryan Roemer</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-120">SurviveJS - Webpack - v1.2.0</a></li><li><a class="blog-teaser" href="/blog/nwb-interview">nwb - CLI for React Applications and Components - Interview with Jonny Buchanan</a></li><li><a class="blog-teaser" href="/blog/kotatsu-interview">Kotatsu - Less Boilerplate for Modern JavaScript - Interview with Guillaume Plique</a></li><li><a class="blog-teaser" href="/blog/hashnode-interview">Hashnode - Community for Software Developers - Interview with Sandeep Panda</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-110">SurviveJS - Webpack - v1.1.0</a></li><li><a class="blog-teaser" href="/blog/frzr-interview">FRZR - a Tiny View Library - Interview with Juha Lindstedt</a></li><li><a class="blog-teaser" href="/blog/survivejs210">SurviveJS - Webpack and React - v2.1.0</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div></main></body></html>