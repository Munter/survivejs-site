<html lang="en"><head><title>SurviveJS - Authoring Packages</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
Even though Webpack is useful for bundling applications, it has its uses for package authors as well. You can use it to output your bundle in the UMD format. It is a format that&#x27;s compatible with various environments (CommonJS, AMD, globals).

"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="./atom.xml"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/library.jpg);"></div><h1 class="post__heading">Authoring Packages</h1><div class="header-extra"><a href="https://www.flickr.com/photos/19219926@N04/3707001321">Duke University Archives (CC BY-NC-SA)</a></div><div class="toc-nav__wrapper"><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/webpack-compared">Webpack Compared</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing-with-webpack">Developing with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/splitting-configuration">Splitting the Configuration</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/refreshing-css">Refreshing CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/setting-up-npm-install-webpack-plugin">Setting Up npm-install-webpack-plugin</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/optimizing-development">Optimizing Development</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building-with-webpack">Building with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/minifying-build">Minifying the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/setting-environment-variables">Setting Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/splitting-bundles">Splitting Bundles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/cleaning-build">Cleaning the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/hosting-on-github-pages">Hosting on GitHub Pages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading-assets">Loading Assets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/formats-supported">Formats Supported</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-styles">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading-assets/loading-fonts">Loading Fonts</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/advanced-techniques">Advanced Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/understanding-chunks">Understanding Chunks</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Authoring Packages</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/writing-loaders">Writing Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/configuring-react">Configuring React</a></li></ul></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/relax-interview">Relax - New generation CMS on top of React and Node.js - Interview with Bruno Mota</a></blockquote><div class="chapter-content"><p>Even though Webpack is useful for bundling applications, it has its uses for package authors as well. You can use it to output your bundle in the <a href="https://github.com/umdjs/umd">UMD format</a>. It is a format that&#39;s compatible with various environments (CommonJS, AMD, globals).</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-umd" id="setting-up-umd"></a><span class="text">Setting Up UMD</span><a class="header-anchor-select" href="#setting-up-umd">#</a></h2>
<p>Allowing Webpack to output your bundle in the UMD format is simple. Webpack allows you to control the output format using <a href="https://webpack.github.io/docs/configuration.html#output-librarytarget">output.libraryTarget</a> field. It defaults to <code>var</code>. This means it will set your bundle to a variable defined using the <code>output.library</code> field. There are other options too, but the one we are interested in is <code>output.libraryTarget: &#39;umd&#39;</code>. Consider the example below:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript">output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
  path<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>dist<span class="token punctuation" >,</span>
  libraryTarget<span class="token punctuation" >:</span> <span class="token string" >'umd'</span><span class="token punctuation" >,</span> <span class="token comment" spellcheck="true">// !!</span>
  <span class="token comment" spellcheck="true">// Name of the generated global.</span>
  library<span class="token punctuation" >:</span> <span class="token string" >'MyLibrary'</span><span class="token punctuation" >,</span>
  <span class="token comment" spellcheck="true">// Optional name for the generated AMD module.</span>
  umdNamedDefine<span class="token punctuation" >:</span> <span class="token string" >'my_library'</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>Given it&#39;s not a good idea to bundle your package dependencies, such as React, within the distribution bundle itself, you should let the user inject them. You can configure external dependencies using the <code>externals</code> configuration. You can control it like this:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript">externals<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
  <span class="token comment" spellcheck="true">// Adapt `import merge from 'lodash/merge';` to different environments.</span>
  <span class="token string" >'lodash/merge'</span><span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    commonjs<span class="token punctuation" >:</span> <span class="token string" >'lodash/merge'</span><span class="token punctuation" >,</span>
    commonjs2<span class="token punctuation" >:</span> <span class="token string" >'lodash/merge'</span><span class="token punctuation" >,</span>
    <span class="token comment" spellcheck="true">// Look up lodash.merge below ['lodash', 'merge'] for AMD.</span>
    amd<span class="token punctuation" >:</span>  <span class="token punctuation" >[</span><span class="token string" >'lodash'</span><span class="token punctuation" >,</span> <span class="token string" >'merge'</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span>
    <span class="token comment" spellcheck="true">// Look up lodash.merge through `_.merge` in global environment.</span>
    root<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'_'</span><span class="token punctuation" >,</span> <span class="token string" >'merge'</span><span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token comment" spellcheck="true">// Adapt React to different environments.</span>
  <span class="token string" >'react'</span><span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    commonjs<span class="token punctuation" >:</span> <span class="token string" >'react'</span><span class="token punctuation" >,</span>
    commonjs2<span class="token punctuation" >:</span> <span class="token string" >'react'</span><span class="token punctuation" >,</span>
    amd<span class="token punctuation" >:</span> <span class="token string" >'React'</span><span class="token punctuation" >,</span>
    root<span class="token punctuation" >:</span> <span class="token string" >'React'</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</code></pre>
<p>These two fields help you a lot as a package author but there&#39;s more to it.</p>
<h2 class="header"><a class="header-anchor" href="#processing-node-js-version-through-babel" id="processing-node-js-version-through-babel"></a><span class="text">Processing Node.js Version through Babel</span><a class="header-anchor-select" href="#processing-node-js-version-through-babel">#</a></h2>
<p>If you are processing your code through Babel, I suggest you process the Node.js version of the package directly through Babel and skip Webpack. The advantage of doing this is that it gives you separate modules that are easier to consume one by one if needed. This avoids having to go through a heavy bundle. In this case you&#39;ll likely want a setup like this:</p>
<p><strong>package.json</strong></p>
<pre><code class="lang-json"><span class="token punctuation" >{</span>
  ..
  /* `npm run &lt;name>` */
  <span class="token property" >"scripts"</span><span class="token operator" >:</span> <span class="token punctuation" >{</span>
    ...
    <span class="token property" >"dist"</span><span class="token operator" >:</span> <span class="token string" >"webpack"</span><span class="token punctuation" >,</span>
    "dist<span class="token operator" >:</span>min"<span class="token operator" >:</span> <span class="token string" >"webpack"</span><span class="token punctuation" >,</span>

    /* Process source through Babel! */
    "dist<span class="token operator" >:</span>modules"<span class="token operator" >:</span> <span class="token string" >"babel ./src --out-dir ./dist-modules"</span><span class="token punctuation" >,</span>

    ...

    <span class="token property" >"preversion"</span><span class="token operator" >:</span> <span class="token string" >"npm run test &amp;&amp; npm run dist &amp;&amp; npm run dist:min &amp;&amp; git commit --allow-empty -am \"</span>Update dist\<span class="token string" >""</span><span class="token punctuation" >,</span>
    <span class="token property" >"prepublish"</span><span class="token operator" >:</span> <span class="token string" >"npm run dist:modules"</span><span class="token punctuation" >,</span>
    ...
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  /* Point to the Node.js specific version */
  <span class="token property" >"main"</span><span class="token operator" >:</span> <span class="token string" >"dist-modules"</span><span class="token punctuation" >,</span>
  ...
<span class="token punctuation" >}</span>
</code></pre>
<p>There is one problem, though. What if someone points to a development version of your package directly through GitHub? It simply won&#39;t work as the <code>dist-modules</code> directory will be missing. This can be fixed using a hook that will generate the needed source.</p>
<h2 class="header"><a class="header-anchor" href="#generating-distribution-for-development-usage" id="generating-distribution-for-development-usage"></a><span class="text">Generating Distribution for Development Usage</span><a class="header-anchor-select" href="#generating-distribution-for-development-usage">#</a></h2>
<p>To solve the development distribution problem, we need to hook up a custom script the right way. First, we need to connect the hook with a custom script:</p>
<p><strong>package.json</strong></p>
<pre><code class="lang-json"><span class="token punctuation" >{</span>
  ...
  <span class="token property" >"scripts"</span><span class="token operator" >:</span> <span class="token punctuation" >{</span>
    ...
    /* Point to the script that generates the missing source. */
    <span class="token property" >"postinstall"</span><span class="token operator" >:</span> <span class="token string" >"node lib/post_install.js"</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token property" >"devDependencies"</span><span class="token operator" >:</span> <span class="token punctuation" >{</span>
    ...
    /* You should install sync-exec through `npm i` to get a recent version */
    <span class="token property" >"sync-exec"</span><span class="token operator" >:</span> <span class="token string" >"^0.6.2"</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>Secondly we&#39;ll need the script itself:</p>
<p><strong>lib/post_install.js</strong></p>
<pre><code class="lang-javascript"><span class="token comment" spellcheck="true">// adapted based on rackt/history (MIT)</span>
<span class="token comment" spellcheck="true">// Node 0.10+</span>
<span class="token keyword" >var</span> execSync <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'child_process'</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span>execSync<span class="token punctuation" >;</span>
<span class="token keyword" >var</span> stat <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'fs'</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span>stat<span class="token punctuation" >;</span>

<span class="token comment" spellcheck="true">// Node 0.10 check</span>
<span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token operator" >!</span>execSync<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  execSync <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'sync-exec'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >function</span> <span class="token function" >exec</span><span class="token punctuation" >(</span>command<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token function" >execSync</span><span class="token punctuation" >(</span>command<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    stdio<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >,</span> <span class="token number" >1</span><span class="token punctuation" >,</span> <span class="token number" >2</span><span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token function" >stat</span><span class="token punctuation" >(</span><span class="token string" >'dist-modules'</span><span class="token punctuation" >,</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>error<span class="token punctuation" >,</span> stat<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token comment" spellcheck="true">// Skip building on Travis</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>process<span class="token punctuation" >.</span>env<span class="token punctuation" >.</span>TRAVIS<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>

  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>error <span class="token operator" >||</span> <span class="token operator" >!</span>stat<span class="token punctuation" >.</span><span class="token function" >isDirectory</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token function" >exec</span><span class="token punctuation" >(</span><span class="token string" >'npm i babel-cli babel-preset-es2015 babel-preset-react'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token function" >exec</span><span class="token punctuation" >(</span><span class="token string" >'npm run dist-modules'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>The script may need tweaking to fit your purposes. But it&#39;s enough to give you a rough idea. If the <code>dist_modules</code> directory is missing, we&#39;ll generate it here. That&#39;s it.</p>
<h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Webpack can do a lot of work for a package author. Just picking up <code>output.libraryTarget</code> and <code>externals</code> help you a lot. These options are useful beyond package authoring. Particularly <code>externals</code> comes in handy when you want to exclude certain dependencies outside of your bundles and load them using some other way.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/chunks.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/advanced-techniques/understanding-chunks">Understanding Chunks</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/loader.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/advanced-techniques/writing-loaders">Writing Loaders</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Writing Loaders" href="/webpack/advanced-techniques/writing-loaders"><i class="icon-right-open"></i></a><a class="previous-page" title="Understanding Chunks" href="/webpack/advanced-techniques/understanding-chunks"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the full ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><div class="right ribbon github-fork-ribbon-wrapper"><div class="github-fork-ribbon" style="background-color:black;"><a href="https://github.com/survivejs/webpack/issues/new?title=Authoring Packages - " target="_blank">Submit feedback</a></div></div><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs/webpack_react" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs/webpack_react" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/relax-interview">Relax - New generation CMS on top of React and Node.js - Interview with Bruno Mota</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-100">SurviveJS - Webpack - v1.0.0</a></li><li><a class="blog-teaser" href="/blog/react-rocks-interview">React.rocks - React Components and Demos - Interview with Jeff Winkler</a></li><li><a class="blog-teaser" href="/blog/reindex-interview">Reindex - Instant GraphQL Backend for Your React Apps - Interview with Ville Immonen</a></li><li><a class="blog-teaser" href="/blog/survivejs-interview">SurviveJS - Learn Webpack and React - Interview with Juho Vepsäläinen</a></li><li><a class="blog-teaser" href="/blog/styleguidist-interview">react-styleguidist - Style guide generator for React - Interview with Artem Sapegin</a></li><li><a class="blog-teaser" href="/blog/survivejs200">SurviveJS - Webpack and React - v2.0.0</a></li><li><a class="blog-teaser" href="/blog/survivejs200-rc4">SurviveJS - Webpack and React - v2.0.0-rc4</a></li><li><a class="blog-teaser" href="/blog/towards-common-components">Towards a Common Component Definition</a></li><li><a class="blog-teaser" href="/blog/survivejs200-rc3">SurviveJS - Webpack and React - v2.0.0-rc3</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack_react'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div></main></body></html>