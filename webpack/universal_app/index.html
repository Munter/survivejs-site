<html lang="en"><head><title>SurviveJS - Universal App</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
So the great thing about React JS is that it runs on the server too. But that does not mean you can just create any app and run it on the server. You have to make some decisions on the architecture. The reason is that even though React JS and the components run on the server, you might be having deâ€¦"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="./atom.xml"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/andromeda.jpg);"></div><h1 class="post__heading">Universal App</h1><div class="header-extra"><a href="https://pixabay.com/en/milky-way-andromeda-stars-galaxy-923801/">skeeze (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/basics_of_webpack">Basics of Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/introduction_to_webpack">Introduction to Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/getting_started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/running_a_workflow">Running a Workflow</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/automatic_browser_refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/requiring_files">Requiring Files</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/css_fonts_and_images">CSS, Fonts, and Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading_css">Loading CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading_less_or_sass">Loading LESS or SASS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading_stylus_and_yeticss">Loading Stylus and YETICSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading_images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading_svg">Loading SVG</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading_fonts">Loading Fonts</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/deployment_strategies">Deployment Strategies</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/deploying_to_production">Deploying to Production</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/single_bundle">Single Bundle</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/splitting_app_and_vendors">Splitting app and vendors</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/chunking_in_webpack">Chunking in Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding_chunks">Understanding Chunks</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/multiple_entry_points">Multiple Entry Points</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/lazy_loaded_entry_points">Lazy Loaded Entry Points</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/advanced_techniques">Advanced Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/authoring_libraries">Authoring Libraries</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/writing_loaders">Writing Loaders</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimization_techniques">Optimization Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing_development">Optimizing Development</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing_caching">Optimizing Caching</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing_rebundling">Optimizing Rebundling</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/react_techniques">React Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/configuring_react">Configuring React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/hot_loading_components">Hot Loading Components</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/type_checking_with_flow">Type Checking with Flow</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Universal App</span></li></ul></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/styleguidist-interview">react-styleguidist - Style guide generator for React - Interview with Artem Sapegin</a></blockquote><div class="chapter-content"><p>So the great thing about React JS is that it runs on the server too. But that does not mean you can just create any app and run it on the server. You have to make some decisions on the architecture. The reason is that even though React JS and the components run on the server, you might be having dependencies in those components that does not run on the server.</p>
<h2 class="header"><a class="header-anchor" href="#injecting-state" id="injecting-state"></a><span class="text">Injecting state</span><a class="header-anchor-select" href="#injecting-state">#</a></h2>
<p>One of the most important decisions you make is to inject the state of your application through the top component. This basically means that your components does not have any external dependencies at all. All they need to know comes through this injected state.</p>
<p>This cookbook is not about isomorphic apps, but let us take a look at an example. We will not use ES6 syntax here because Node JS does not support it yet.</p>
<p><em>main.js (client)</em></p>
<pre><code class="lang-javascript"><span class="token keyword" >var</span> React <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'react'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >var</span> AppState <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./client/AppState.js'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >var</span> App <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./App.js'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

React<span class="token punctuation" >.</span><span class="token function" >render</span><span class="token punctuation" >(</span><span class="token operator" >&lt;</span>App state<span class="token operator" >=</span><span class="token punctuation" >{</span>AppState<span class="token punctuation" >}</span><span class="token operator" >/</span><span class="token operator" >></span><span class="token punctuation" >,</span> document<span class="token punctuation" >.</span>body<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p><em>router.js (server)</em></p>
<pre><code class="lang-javascript"><span class="token keyword" >var</span> React <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'react'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >var</span> App <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./App.js'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >var</span> AppState <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./server/AppState.js'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >var</span> index <span class="token operator" >=</span> <span class="token string" >'&lt;!DOCTYPE html>&lt;html>&lt;head>&lt;/head>&lt;body>{{component}}&lt;/body>&lt;/html>'</span><span class="token punctuation" >;</span>

app<span class="token punctuation" >.</span><span class="token keyword" >get</span><span class="token punctuation" >(</span><span class="token string" >'/'</span><span class="token punctuation" >,</span> <span class="token keyword" >function</span> <span class="token punctuation" >(</span>req<span class="token punctuation" >,</span> res<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >var</span> componentHtml <span class="token operator" >=</span> React<span class="token punctuation" >.</span><span class="token function" >renderToString</span><span class="token punctuation" >(</span><span class="token function" >App</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>state<span class="token punctuation" >:</span> AppState<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token keyword" >var</span> html <span class="token operator" >=</span> index<span class="token punctuation" >.</span><span class="token function" >replace</span><span class="token punctuation" >(</span><span class="token string" >'{{component}}'</span><span class="token punctuation" >,</span> componentHtml<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  res<span class="token punctuation" >.</span><span class="token function" >type</span><span class="token punctuation" >(</span><span class="token string" >'html'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  res<span class="token punctuation" >.</span><span class="token function" >send</span><span class="token punctuation" >(</span>html<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
<p>So this was a very naive and simple way of showing it, but what you should notice here is that we use the same <strong>App.js</strong> file on the client and server, but we have two different ways of producing the state.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev" style="width:100%;"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/water.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/type_checking_with_flow">Type Checking with Flow</a></div></div><div id="disqus_thread"></div></div><div><a class="previous-page" title="Type Checking with Flow" href="/webpack/type_checking_with_flow"><i class="icon-left-open"></i></a></div></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs_webpack">Buy the full ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><div class="right ribbon github-fork-ribbon-wrapper"><div class="github-fork-ribbon" style="background-color:black;"><a href="https://github.com/survivejs/webpack_react/issues/new?title=Universal App - " target="_blank">Submit feedback</a></div></div><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs/webpack_react" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs/webpack_react" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/styleguidist-interview">react-styleguidist - Style guide generator for React - Interview with Artem Sapegin</a></li><li><a class="blog-teaser" href="/blog/survivejs200">SurviveJS - Webpack and React - v2.0.0</a></li><li><a class="blog-teaser" href="/blog/survivejs200-rc4">SurviveJS - Webpack and React - v2.0.0-rc4</a></li><li><a class="blog-teaser" href="/blog/towards-common-components">Towards a Common Component Definition</a></li><li><a class="blog-teaser" href="/blog/survivejs200-rc3">SurviveJS - Webpack and React - v2.0.0-rc3</a></li><li><a class="blog-teaser" href="/blog/survivejs200-rc2">SurviveJS - Webpack and React - v2.0.0-rc2</a></li><li><a class="blog-teaser" href="/blog/survivejs200-rc1">SurviveJS - Webpack and React - v2.0.0-rc1</a></li><li><a class="blog-teaser" href="/blog/codemod-interview">Codemod - Refactoring Code Programmatically - Interview with Ramana Venkata</a></li><li><a class="blog-teaser" href="/blog/2015-recap">2015 Recap</a></li><li><a class="blog-teaser" href="/blog/survivejs200-beta2">SurviveJS - Webpack and React - v2.0.0-beta2</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack_react'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div></main></body></html>